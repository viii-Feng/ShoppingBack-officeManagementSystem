import{u as ce}from"./setting-66b93d0e.js";import{J as k,d as fe,u as ve,r as m,c as _e,G as ge,e as p,o as I,f as M,g as e,w as t,h as r,C as h,j as d,m as A,t as B,v as G,n as ye,F as H,q as be,z as J,K as C,p as we,k as Ve,_ as he}from"./index-afa834e1.js";const Ce=(n,x,i)=>k.get(`/admin/acl/user/${n}/${x}/?username=${i}`),ke=n=>n.id?k.put("/admin/acl/user/update",n):k.post("/admin/acl/user/save",n),xe=n=>k.get("/admin/acl/user/toAssign/"+n),Ue=n=>k.post("/admin/acl/user/doAssignRole",n),Se=n=>k.delete("/admin/acl/user/remove/"+n),ze=n=>k.delete("/admin/acl/user/batchRemove",{data:n}),Re=n=>(we("data-v-8ed91b45"),n=n(),Ve(),n),qe={style:{flex:"auto"}},Ie=Re(()=>A("h4",null,"分配角色(职位)",-1)),Ae={style:{flex:"auto"}},Ne=fe({__name:"index",setup(n){let x=ve(),i=m(1),U=m(5),O=m(0),z=m([]),f=m(!1),v=m(!1),S=m([]),g=m([]),s=_e({username:"",name:"",password:""}),N=m([]),y=m(),b=m(""),$=ce();ge(()=>{w()});const w=async(o=1)=>{i.value=o;let l=await Ce(i.value,U.value,b.value);l.code==200&&(O.value=l.data.total,z.value=l.data.records)},K=()=>{w()},Z=()=>{f.value=!0,Object.assign(s,{id:0,username:"",name:"",password:""}),J(()=>{y.value.clearValidate("username"),y.value.clearValidate("name"),y.value.clearValidate("password")})},Q=o=>{if(x.$state.username==o.username){C({type:"error",message:"不能修改自己用户名"});return}f.value=!0,Object.assign(s,o),J(()=>{y.value.clearValidate("username"),y.value.clearValidate("name")})},W=async()=>{await y.value.validate(),(await ke(s)).code==200?(f.value=!1,C({type:"success",message:s.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,C({type:"error",message:s.id?"更新失败":"添加失败"}))},X=()=>{f.value=!1},Y={username:[{required:!0,trigger:"blur",validator:(o,l,u)=>{console.log(x.$state.username),l.trim().length>=5?u():u(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=5?u():u(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=6?u():u(new Error("用户密码至少六位"))}}]},ee=async o=>{Object.assign(s,o);let l=await xe(s.id);l.code==200&&(S.value=l.data.allRolesList,g.value=l.data.assignRoles,v.value=!0)},R=m(!1),q=m(!0),le=()=>{R.value=!1,q.value=!0},ae=o=>{g.value=o?S.value:[],q.value=!1},te=o=>{R.value=o.length===S.value.length,q.value=o.length!==S.value.length},oe=async()=>{let o={userId:s.id,roleIdList:g.value.map(u=>u.id)};(await Ue(o)).code==200&&(C({type:"success",message:"分配职务成功"}),v.value=!1,w(i.value))},re=async o=>{if(x.$state.username==o.username){C({type:"error",message:"不能删除自己用户"});return}(await Se(o.id)).code==200&&(C({type:"success",message:"删除成功"}),w(z.value.length>1?i.value:i.value-1))},se=o=>{N.value=o},ne=async()=>{let o=N.value.map(u=>u.id);(await ze(o)).code==200&&(C({type:"success",message:"删除成功"}),w(z.value.length>1?i.value:i.value-1))},ue=()=>{w(),b.value=""},de=()=>{$.refsh=!$.refsh};return(o,l)=>{const u=p("el-input"),V=p("el-form-item"),c=p("el-button"),E=p("el-form"),j=p("el-card"),L=p("el-popconfirm"),_=p("el-table-column"),ie=p("el-table"),me=p("el-pagination"),T=p("el-drawer"),P=p("el-checkbox"),pe=p("el-checkbox-group");return I(),M(H,null,[e(j,{style:{height:"80px"}},{default:t(()=>[e(E,{inline:!0,class:"form"},{default:t(()=>[e(V,{label:"用户名:"},{default:t(()=>[e(u,{placeholder:"请你输入搜索用户名",modelValue:r(b),"onUpdate:modelValue":l[0]||(l[0]=a=>h(b)?b.value=a:b=a)},null,8,["modelValue"])]),_:1}),e(V,null,{default:t(()=>[e(c,{type:"primary",size:"default",disabled:!r(b),onClick:ue},{default:t(()=>[d("搜索")]),_:1},8,["disabled"]),e(c,{type:"primary",size:"default",onClick:de},{default:t(()=>[d("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(j,{style:{margin:"10px 0px"}},{default:t(()=>[e(c,{type:"primary",size:"default",onClick:Z},{default:t(()=>[d("添加用户")]),_:1}),e(L,{title:"确定删除?",width:"260px",onConfirm:ne},{reference:t(()=>[e(c,{type:"primary",size:"default",disabled:!r(N).length},{default:t(()=>[d("批量删除")]),_:1},8,["disabled"])]),_:1}),d("> "),e(ie,{onSelectionChange:se,style:{margin:"10px 0px"},border:"",data:r(z)},{default:t(()=>[e(_,{type:"selection",align:"center"}),e(_,{label:"#",align:"center",type:"index"}),e(_,{label:"ID",align:"center",prop:"id"}),e(_,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),e(_,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),e(_,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(_,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(_,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(_,{label:"操作",width:"300px",align:"center"},{default:t(({row:a,$index:D})=>[e(c,{type:"primary",size:"small",icon:"User",onClick:F=>ee(a)},{default:t(()=>[d("分配角色")]),_:2},1032,["onClick"]),e(c,{type:"primary",size:"small",icon:"Edit",onClick:F=>Q(a)},{default:t(()=>[d("编辑")]),_:2},1032,["onClick"]),e(L,{title:`你确定要删除${a.username}?`,width:"260px",onConfirm:F=>re(a)},{reference:t(()=>[e(c,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[d("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(me,{"current-page":r(i),"onUpdate:currentPage":l[1]||(l[1]=a=>h(i)?i.value=a:i=a),"page-size":r(U),"onUpdate:pageSize":l[2]||(l[2]=a=>h(U)?U.value=a:U=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:r(O),onCurrentChange:w,onSizeChange:K},null,8,["current-page","page-size","total"])]),_:1}),e(T,{modelValue:r(f),"onUpdate:modelValue":l[6]||(l[6]=a=>h(f)?f.value=a:f=a)},{header:t(()=>[A("h4",null,B(r(s).id?"更新用户":"添加用户"),1)]),default:t(()=>[e(E,{model:r(s),rules:Y,ref_key:"formRef",ref:y},{default:t(()=>[e(V,{label:"用户姓名",prop:"username"},{default:t(()=>[e(u,{placeholder:"请您输入用户姓名",modelValue:r(s).username,"onUpdate:modelValue":l[3]||(l[3]=a=>r(s).username=a)},null,8,["modelValue"])]),_:1}),e(V,{label:"用户昵称",prop:"name"},{default:t(()=>[e(u,{placeholder:"请您输入用户昵称",modelValue:r(s).name,"onUpdate:modelValue":l[4]||(l[4]=a=>r(s).name=a)},null,8,["modelValue"])]),_:1}),r(s).id?ye("",!0):(I(),G(V,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[e(u,{placeholder:"请您输入用户密码",modelValue:r(s).password,"onUpdate:modelValue":l[5]||(l[5]=a=>r(s).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[A("div",qe,[e(c,{onClick:X},{default:t(()=>[d("取消")]),_:1}),e(c,{type:"primary",onClick:W},{default:t(()=>[d("确定")]),_:1})])]),_:1},8,["modelValue"]),e(T,{modelValue:r(v),"onUpdate:modelValue":l[11]||(l[11]=a=>h(v)?v.value=a:v=a),onOpen:le},{header:t(()=>[Ie]),default:t(()=>[e(E,null,{default:t(()=>[e(V,{label:"用户姓名"},{default:t(()=>[e(u,{modelValue:r(s).username,"onUpdate:modelValue":l[7]||(l[7]=a=>r(s).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),e(V,{label:"职位列表"},{default:t(()=>[e(P,{onChange:ae,modelValue:R.value,"onUpdate:modelValue":l[8]||(l[8]=a=>R.value=a),indeterminate:q.value},{default:t(()=>[d("全选")]),_:1},8,["modelValue","indeterminate"]),e(pe,{modelValue:r(g),"onUpdate:modelValue":l[9]||(l[9]=a=>h(g)?g.value=a:g=a),onChange:te},{default:t(()=>[(I(!0),M(H,null,be(r(S),(a,D)=>(I(),G(P,{key:D,label:a},{default:t(()=>[d(B(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[A("div",Ae,[e(c,{onClick:l[10]||(l[10]=a=>h(v)?v.value=!1:v=!1)},{default:t(()=>[d("取消")]),_:1}),e(c,{type:"primary",onClick:oe},{default:t(()=>[d("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const Te=he(Ne,[["__scopeId","data-v-8ed91b45"]]);export{Te as default};
