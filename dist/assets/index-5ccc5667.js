import{J as $,d as le,r as p,R as ie,e as s,o as S,v as w,w as l,g as e,h as n,f as B,F as T,q as M,C as G,m as Q,j as F,t as pe,K as z,z as ce,c as me,O as _e,N as fe,y as ge,H as Se,A as Z,B as ee}from"./index-afa834e1.js";const ye=(y,U,V)=>$.get(`/admin/product/${y}/${U}?category3Id=${V}`),te=()=>$.get("/admin/product/baseTrademark/getTrademarkList"),ne=y=>$.get("/admin/product/spuImageList/"+y),ue=y=>$.get("/admin/product/spuSaleAttrList/"+y),ae=()=>$.get("/admin/product/baseSaleAttrList"),ve=y=>y.id?$.post("/admin/product/updateSpuInfo",y):$.post("/admin/product/saveSpuInfo",y),be=y=>$.post("/admin/product/saveSkuInfo",y),Ve=y=>$.get("/admin/product/findBySpuId/"+y),ke=y=>$.delete("/admin/product/deleteSpu/"+y),Ae=["src"],Ie=le({__name:"spuForm",emits:["changeScene"],setup(y,{expose:U,emit:V}){const I=()=>{V("changeScene",{flag:0,params:"update"})};let x=p([]),k=p([]),A=p([]),r=p([]),N=p(!1),R=p(""),d=p({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),b=p("");const L=async a=>{d.value=a;let t=await te(),g=await ne(a.id),C=await ue(a.id),E=await ae();x.value=t.data,k.value=g.data.map(P=>({name:P.imgName,url:P.imgUrl})),A.value=C.data,r.value=E.data},i=a=>{R.value=a.url,N.value=!0},c=()=>{console.log(123)},m=a=>a.type=="image/png"||a.type=="image/jpeg"||a.type=="image/gif"?a.size/1024/1024<3?!0:(z({type:"error",message:"上传文件务必小于3M"}),!1):(z({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let h=ie(()=>r.value.filter(t=>A.value.every(g=>t.name!=g.saleAttrName)));const D=()=>{const[a,t]=b.value.split(":");let g={baseSaleAttrId:a,saleAttrName:t,spuSaleAttrValueList:[]};A.value.push(g),b.value=""},K=p(),_=a=>{a.flag=!0,a.saleAttrValue="",ce(()=>{K.value.focus()})},f=a=>{console.log(A.value);const{baseSaleAttrId:t,saleAttrValue:g}=a;let C={baseSaleAttrId:t,saleAttrValueName:g};if(g.trim()==""){z({type:"error",message:"属性值不能为空"}),a.flag=!1;return}if(a.spuSaleAttrValueList.find(P=>P.saleAttrValueName==g)){z({type:"error",message:"属性值重复"}),a.flag=!1;return}a.spuSaleAttrValueList.push(C),a.flag=!1},O=async()=>{d.value.spuImageList=k.value.map(t=>({imgName:t.name,imgUrl:t.response&&t.response.data||t.url})),d.value.spuSaleAttrList=A.value,(await ve(d.value)).code==200?(z({type:"success",message:d.value.id?"更新成功":"添加成功"}),V("changeScene",{flag:0,params:d.value.id?"update":"add"})):z({type:"error",message:d.value.id?"更新失败":"添加失败"})};return U({initHasSpuData:L,initAddSpu:async a=>{Object.assign(d.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),k.value=[],A.value=[],b.value="",d.value.category3Id=a;let t=await te(),g=await ae();x.value=t.data,r.value=g.data}}),(a,t)=>{const g=s("el-input"),C=s("el-form-item"),E=s("el-option"),P=s("el-select"),W=s("Plus"),X=s("el-icon"),Y=s("el-upload"),v=s("el-dialog"),H=s("el-button"),q=s("el-table-column"),oe=s("el-tag"),se=s("el-table"),re=s("el-form");return S(),w(re,{"label-width":"100px"},{default:l(()=>[e(C,{label:"SPU名称"},{default:l(()=>[e(g,{placeholder:"请你输入SPU名称",modelValue:n(d).spuName,"onUpdate:modelValue":t[0]||(t[0]=u=>n(d).spuName=u)},null,8,["modelValue"])]),_:1}),e(C,{label:"SPU品牌"},{default:l(()=>[e(P,{modelValue:n(d).tmId,"onUpdate:modelValue":t[1]||(t[1]=u=>n(d).tmId=u)},{default:l(()=>[(S(!0),B(T,null,M(n(x),(u,J)=>(S(),w(E,{key:u.id,label:u.tmName,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"SPU描述"},{default:l(()=>[e(g,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:n(d).description,"onUpdate:modelValue":t[2]||(t[2]=u=>n(d).description=u)},null,8,["modelValue"])]),_:1}),e(C,{label:"SPU图片"},{default:l(()=>[e(Y,{"file-list":n(k),"onUpdate:fileList":t[3]||(t[3]=u=>G(k)?k.value=u:k=u),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":i,"on-remove":c,"before-upload":m},{default:l(()=>[e(X,null,{default:l(()=>[e(W)]),_:1})]),_:1},8,["file-list"]),e(v,{modelValue:n(N),"onUpdate:modelValue":t[4]||(t[4]=u=>G(N)?N.value=u:N=u)},{default:l(()=>[Q("img",{"w-full":"",src:n(R),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Ae)]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"SPU销售属性"},{default:l(()=>[e(P,{modelValue:n(b),"onUpdate:modelValue":t[5]||(t[5]=u=>G(b)?b.value=u:b=u),placeholder:n(h).length?`还未选择${n(h).length}个`:"无"},{default:l(()=>[(S(!0),B(T,null,M(n(h),(u,J)=>(S(),w(E,{value:`${u.id}:${u.name}`,key:u.id,label:u.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"]),e(H,{onClick:D,disabled:!n(b),style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus"},{default:l(()=>[F("添加属性")]),_:1},8,["disabled"]),e(se,{border:"",style:{margin:"10px 0px"},data:n(A)},{default:l(()=>[e(q,{label:"序号",type:"index",align:"center",width:"80px"}),e(q,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(q,{label:"销售属性值"},{default:l(({row:u,$index:J})=>[(S(!0),B(T,null,M(u.spuSaleAttrValueList,(j,de)=>(S(),w(oe,{style:{margin:"0px 5px"},onClose:Ce=>u.spuSaleAttrValueList.splice(de,1),key:u.id,class:"mx-1",closable:""},{default:l(()=>[F(pe(j.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),u.flag==!0?(S(),w(g,{key:0,ref_key:"inputRef",ref:K,onBlur:j=>f(u),autofocus:"",modelValue:u.saleAttrValue,"onUpdate:modelValue":j=>u.saleAttrValue=j,placeholder:"请你输入属性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(S(),w(H,{key:1,onClick:j=>_(u),color:"#00AA00",type:"primary",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(q,{label:"操作",width:"120px"},{default:l(({row:u,$index:J})=>[e(H,{type:"primary",size:"small",icon:"Delete",onClick:j=>n(A).splice(J,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(C,null,{default:l(()=>[e(H,{disabled:!(n(A).length>0),type:"primary",size:"default",onClick:O},{default:l(()=>[F("保存")]),_:1},8,["disabled"]),e(H,{type:"primary",siFze:"default",onClick:I},{default:l(()=>[F("取消")]),_:1})]),_:1})]),_:1})}}}),Ue=["src"],he=le({__name:"skuForm",emits:["changeScene"],setup(y,{expose:U,emit:V}){let I=p([]),x=p([]),k=p([]),A=p(),r=me({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const N=async(L,i,c)=>{r.category3Id=c.category3Id,r.spuId=c.id,r.tmId=c.tmId;let m=await _e(L,i,c.category3Id),h=await ue(c.id),D=await ne(c.id);I.value=m.data,x.value=h.data,k.value=D.data},R=()=>{V("changeScene",{flag:0,params:""})},d=L=>{k.value.forEach(i=>{A.value.toggleRowSelection(i,!1)}),A.value.toggleRowSelection(L,!0),r.skuDefaultImg=L.imgUrl};U({initSkuData:N});const b=async()=>{r.skuAttrValueList=I.value.reduce((i,c)=>{if(c.attrIdAndValueId){let[m,h]=c.attrIdAndValueId.split(":");i.push({attrId:m,valueId:h})}return i},[]),r.skuSaleAttrValueList=x.value.reduce((i,c)=>{if(c.saleIdAndValueId){let[m,h]=c.saleIdAndValueId.split(":");i.push({saleAttrId:m,saleAttrValueId:h})}return i},[]),(await be(r)).code==200?(z({type:"success",message:"添加SKU成功"}),V("changeScene",{flag:0,params:""})):z({type:"error",message:"添加SKU失败"})};return(L,i)=>{const c=s("el-input"),m=s("el-form-item"),h=s("el-option"),D=s("el-select"),K=s("el-form"),_=s("el-table-column"),f=s("el-button"),O=s("el-table");return S(),w(K,{"label-width":"100px"},{default:l(()=>[e(m,{label:"SKU名称"},{default:l(()=>[e(c,{placeholder:"SKU名称",modelValue:n(r).skuName,"onUpdate:modelValue":i[0]||(i[0]=o=>n(r).skuName=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"价格(元)"},{default:l(()=>[e(c,{placeholder:"价格(元)",type:"number",modelValue:n(r).price,"onUpdate:modelValue":i[1]||(i[1]=o=>n(r).price=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"重量(g)"},{default:l(()=>[e(c,{placeholder:"重量(g)",type:"number",modelValue:n(r).weight,"onUpdate:modelValue":i[2]||(i[2]=o=>n(r).weight=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"SKU描述"},{default:l(()=>[e(c,{placeholder:"SKU描述",type:"textarea",modelValue:n(r).skuDesc,"onUpdate:modelValue":i[3]||(i[3]=o=>n(r).skuDesc=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"平台属性"},{default:l(()=>[e(K,{inline:!0},{default:l(()=>[(S(!0),B(T,null,M(n(I),(o,a)=>(S(),w(m,{key:o.id,label:o.attrName},{default:l(()=>[e(D,{modelValue:o.attrIdAndValueId,"onUpdate:modelValue":t=>o.attrIdAndValueId=t},{default:l(()=>[(S(!0),B(T,null,M(o.attrValueList,(t,g)=>(S(),w(h,{value:`${o.id}:${t.id}`,key:t.id,label:t.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(m,{label:"销售属性"},{default:l(()=>[e(K,{inline:!0},{default:l(()=>[(S(!0),B(T,null,M(n(x),(o,a)=>(S(),w(m,{label:o.saleAttrName,key:o.id},{default:l(()=>[e(D,{modelValue:o.saleIdAndValueId,"onUpdate:modelValue":t=>o.saleIdAndValueId=t},{default:l(()=>[(S(!0),B(T,null,M(o.spuSaleAttrValueList,(t,g)=>(S(),w(h,{value:`${o.id}:${t.id}`,key:t.id,label:t.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(m,{label:"图片名称"},{default:l(()=>[e(O,{border:"",data:n(k),ref_key:"table",ref:A},{default:l(()=>[e(_,{type:"selection",width:"80px",align:"center"}),e(_,{label:"图片"},{default:l(({row:o,$index:a})=>[Q("img",{src:o.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,Ue)]),_:1}),e(_,{label:"名称",prop:"imgName"}),e(_,{label:"操作"},{default:l(({row:o,$index:a})=>[e(f,{type:"primary",size:"small",onClick:t=>d(o)},{default:l(()=>[F("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(m,null,{default:l(()=>[e(f,{type:"primary",size:"default",onClick:b},{default:l(()=>[F("保存")]),_:1}),e(f,{type:"primary",size:"default",onClick:R},{default:l(()=>[F("取消")]),_:1})]),_:1})]),_:1})}}}),xe=["src"],Ne=le({__name:"index",setup(y){let U=fe(),V=p(0),I=p(1),x=p(3),k=p([]),A=p(0),r=p(),N=p(),R=p([]),d=p(!1);ge(()=>U.c3Id,()=>{k.value=[],U.c3Id&&b()});const b=async(_=1)=>{I.value=_;let f=await ye(I.value,x.value,U.c3Id);f.code==200&&(k.value=f.data.records,A.value=f.data.total)},L=()=>{b()},i=()=>{V.value=1,r.value.initAddSpu(U.c3Id)},c=_=>{V.value=1,r.value.initHasSpuData(_)},m=_=>{V.value=_.flag,_.params=="update"?b(I.value):b()},h=_=>{V.value=2,N.value.initSkuData(U.c1Id,U.c2Id,_)},D=async _=>{let f=await Ve(_.id);f.code==200&&(R.value=f.data,d.value=!0)},K=async _=>{(await ke(_.id)).code==200?(z({type:"success",message:"删除成功"}),b(k.value.length>1?I.value:I.value-1)):z({type:"error",message:"删除失败"})};return Se(()=>{U.$reset()}),(_,f)=>{const O=s("Category"),o=s("el-button"),a=s("el-table-column"),t=s("Edit"),g=s("el-icon"),C=s("View"),E=s("el-popconfirm"),P=s("el-table"),W=s("el-pagination"),X=s("el-dialog"),Y=s("el-card");return S(),B("div",null,[e(O,{scene:n(V)},null,8,["scene"]),e(Y,{style:{margin:"10px 0px"}},{default:l(()=>[Z(Q("div",null,[e(o,{onClick:i,type:"primary",size:"default",icon:"Plus",disabled:!n(U).c3Id},{default:l(()=>[F("添加SPU")]),_:1},8,["disabled"]),e(P,{style:{margin:"10px 0px"},border:"",data:n(k)},{default:l(()=>[e(a,{label:"序号",type:"index",align:"center",width:"80px"}),e(a,{label:"SPU名称",prop:"spuName"}),e(a,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(a,{label:"SPU操作"},{default:l(({row:v,$index:H})=>[e(o,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:q=>h(v)},null,8,["onClick"]),e(o,{type:"primary",color:"#FF8800",size:"small",title:"修改SPU",onClick:q=>c(v)},{default:l(()=>[e(g,{color:"white"},{default:l(()=>[e(t)]),_:1})]),_:2},1032,["onClick"]),e(o,{type:"primary",color:"#888888",size:"small",title:"查看SKU列表",onClick:q=>D(v)},{default:l(()=>[e(g,{color:"white"},{default:l(()=>[e(C)]),_:1})]),_:2},1032,["onClick"]),e(E,{title:`你确定删除${v.spuName}?`,width:"200px",onConfirm:q=>K(v)},{reference:l(()=>[e(o,{type:"primary",color:"#CC0000",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(W,{"current-page":n(I),"onUpdate:currentPage":f[0]||(f[0]=v=>G(I)?I.value=v:I=v),"page-size":n(x),"onUpdate:pageSize":f[1]||(f[1]=v=>G(x)?x.value=v:x=v),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:n(A),onCurrentChange:b,onSizeChange:L},null,8,["current-page","page-size","total"])],512),[[ee,n(V)==0]]),Z(e(Ie,{ref_key:"spu",ref:r,onChangeScene:m},null,512),[[ee,n(V)==1]]),Z(e(he,{ref_key:"sku",ref:N,onChangeScene:m},null,512),[[ee,n(V)==2]]),e(X,{modelValue:n(d),"onUpdate:modelValue":f[2]||(f[2]=v=>G(d)?d.value=v:d=v),title:"SKU列表"},{default:l(()=>[e(P,{border:"",data:n(R)},{default:l(()=>[e(a,{label:"SKU名字",prop:"skuName"}),e(a,{label:"SKU价格",prop:"price"}),e(a,{label:"SKU重量",prop:"weight"}),e(a,{label:"SKU图片"},{default:l(({row:v,$index:H})=>[Q("img",{src:v.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,xe)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{Ne as default};
